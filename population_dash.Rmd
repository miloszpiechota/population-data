---
title: "Population Data - Spain and United Arab Emiartes"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    source_code: embed
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(googlesheets4)


```

DATA SET {data-icon="fa-list"}
=====================================

**Population Data - ES + UAE** Data Set.

Column {data-width=300}
-----------------------------------------------------------------------

### Data Set Basic Information

This dataset contains artificially generated data on the population of two countries: **Spain (ES)** and the **United Arab Emirates (UAE)**. The data has been curated to analyze trends and insights related to various demographic characteristics, including age, gender, or BMI. It is specifically focused on understanding the ...

The dataset includes variables such as:
- **height**: 
- **weight**: 
- **sex**: 
- **year**: 
- **age**: 
- **education**: 
- **bmi**: 

### Aims 

This dataset aims to explore the correlation between vaccination rates, age, and other demographic factors, allowing for a better understanding of the vaccination trends in Spain and the UAE. The intention is to investigate how these countries are progressing with their vaccination campaigns and whether there are observable differences based on demographic variables.

The data comes from a combination of publicly available research and artificial data generation, and serves as a basis for comparing vaccination uptake in two regions with distinct demographic and cultural contexts.




Column {data-width=300}
-----------------------------------------------------------------------
### Data Set


```{r}
library(DT)
library(tidyverse)
library(flexdashboard)
library(ggplot2)

ES_UAE_sheet_id<- "1MPRhaBzMiVvIzX3NQJhgDvrtRi5mVChwExsJNsNU8gI"
ES_UAE_sheet_name <- "Data_ES_ZEA"

ES_UAE_data <- read_sheet(ES_UAE_sheet_id, sheet = ES_UAE_sheet_name)
ES_UAE_data %>%
  DT::datatable(rownames = FALSE, options=list(pageLength=15))
```

PAIR PLOT{data-icon="fa-list"}
=====================================

Column {data-width=300}
-----------------------------------------------------------------------

### Data Set

```{r}
library(GGally)
library(googlesheets4)
library(dplyr)
library(DT)

ES_UAE_sheet_id <- "1MPRhaBzMiVvIzX3NQJhgDvrtRi5mVChwExsJNsNU8gI"
ES_UAE_sheet_name <- "Data_ES_ZEA"

ES_UAE_data <- read_sheet(ES_UAE_sheet_id, sheet = ES_UAE_sheet_name)

ES_UAE_data %>%
  select(height, weight, sex, age, year) %>%
  DT::datatable(rownames = FALSE, 
                options = list(pageLength = 60, scrollY = "600px"))
```

### Information

ðŸ§  Analysis of the Pair Plot
What the Plot Shows
This is a pair plot (generated with GGally::ggpairs), which visualizes pairwise relationships between four numerical variables:

height

weight

age

year

Each cell in the matrix shows:

Diagonals: Distributions (histograms or density plots) of individual variables.

Lower triangle: Scatterplots showing how two variables relate to each other.

Upper triangle: Correlation coefficients between variable pairs, with significance indicators (e.g., *** for p < 0.001).

ðŸ“Š Key Observations & Insights

ðŸ”¹ Wzrost i waga:
Istnieje silna dodatnia korelacja miÄ™dzy wzrostem a wagÄ… (Corr: 0.698 ogÃ³Å‚em, 0.634 kobiety, 0.705 mÄ™Å¼czyÅºni).

Pokazuje to, Å¼e osoby wyÅ¼sze zwykle majÄ… wiÄ™kszÄ… wagÄ™, co jest zgodne z oczekiwaniami fizjologicznymi.

ðŸ”¹ Waga i wiek:
Umiarkowana korelacja (Corr: 0.520 ogÃ³Å‚em, silniejsza dla mÄ™Å¼czyzn 0.549 niÅ¼ kobiet 0.514).

Wskazuje, Å¼e z wiekiem moÅ¼e rosnÄ…Ä‡ waga, choÄ‡ nie u wszystkich w rÃ³wnym stopniu.

ðŸ”¹ Wzrost i wiek:
SÅ‚absza korelacja (0.447 ogÃ³Å‚em), jednak wyraÅºniejsza u mÄ™Å¼czyzn (0.466) niÅ¼ u kobiet (0.446).

MoÅ¼e sugerowaÄ‡ rÃ³Å¼nice pokoleniowe (np. mÅ‚odsze osoby sÄ… nieco wyÅ¼sze).

ðŸ”¹ Zmienna 'year' (rok urodzenia):
Bardzo niska lub zerowa korelacja z pozostaÅ‚ymi zmiennymi.

Oznacza, Å¼e dane mogÄ… byÄ‡ rÃ³wnomiernie rozproszone w czasie lub ta zmienna nie wpÅ‚ywa bezpoÅ›rednio na inne.

ðŸ‘¨ðŸ¦± RÃ³Å¼nice pÅ‚ciowe

ðŸ”¹ MÄ™Å¼czyÅºni (1) sÄ… przeciÄ™tnie wyÅ¼si i ciÄ™Å¼si niÅ¼ kobiety (0), co potwierdzajÄ… zarÃ³wno wykresy rozrzutu, jak i boxploty.

RÃ³Å¼nice te sÄ… wyraÅºne w rozkÅ‚adach gÄ™stoÅ›ci dla wzrostu i wagi.

ðŸ“ˆ RozkÅ‚ady i histogramy

ðŸ”¹ Histogramy na przekÄ…tnej pokazujÄ…, Å¼e wzrost i waga majÄ… rozkÅ‚ady zbliÅ¼one do normalnych.

ðŸ”¹ Wiek i rok sÄ… bardziej rÃ³wnomiernie rozÅ‚oÅ¼one lub z lekkimi wypiÄ™trzeniami.

Column {data-width=300}
-----------------------------------------------------------------------

### Pair Plot of Numerical Variables

```{r}
library(GGally)
library(ggplot2)

# Factorize 'sex' if it's not already a factor
ES_UAE_data$sex <- as.factor(ES_UAE_data$sex)

# Improved Pair Plot
ggpairs(
  ES_UAE_data[, c("height", "weight", "age", "year", "sex")],
  mapping = aes(color = sex, alpha = 0.4),  # group by sex
  title = "Pair Plot: Height, Weight, Age, Year (Colored by Sex)",
  upper = list(continuous = wrap("cor", size = 4)),
  lower = list(continuous = wrap("points", alpha = 0.3, size = 1)),
  diag = list(continuous = wrap("densityDiag", alpha = 0.4))
) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    strip.text = element_text(size = 11)
  )


```
**Legend:** ðŸ”µ Male (1), ðŸ”´ Female (0)



Education Plots {data-icon="fa-list"}
=====================================





```{r, warning=FALSE, message=FALSE}
# Wczytywanie bibliotek
library(googlesheets4)
library(DT)
library(tidyverse)
library(ggpubr)

# Zdefiniowanie identyfikatora arkusza
ES_UAE_sheet_id <- "1MPRhaBzMiVvIzX3NQJhgDvrtRi5mVChwExsJNsNU8gI"
ES_UAE_sheet_name <- "Data_ES_ZEA"

# Pobranie danych z arkusza Google
ES_UAE_data <- read_sheet(ES_UAE_sheet_id, sheet = ES_UAE_sheet_name)

# Upewnijmy siÄ™, Å¼e dane sÄ… odpowiednio sformatowane
ES_UAE_data$sex <- factor(ES_UAE_data$sex, levels = c(0, 1), labels = c("Female", "Male"))
ES_UAE_data$education <- factor(ES_UAE_data$education, 
                                levels = c("No Education", "Primary", "Secondary", "Tertiary"))
ES_UAE_data$country <- factor(ES_UAE_data$country, 
                              levels = c("ES", "UAE"), labels = c("Spain", "UAE"))

# Wykres 1: Liczba osÃ³b wg kategorii edukacji
plot1 <- ggplot(ES_UAE_data, aes(x = education, fill = country)) +
  geom_bar(position = "dodge") +
  labs(
    title = "Liczba osÃ³b wg kategorii edukacji",
    x = "Poziom edukacji", y = "Liczba", fill = "Kraj"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Wykres 2: Poziom edukacji wg pÅ‚ci (procentowo) z podziaÅ‚em na kraje
plot2 <- ggplot(ES_UAE_data, aes(x = education, fill = sex)) +
  geom_bar(position = "fill") +
  facet_wrap(~country) +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Poziom edukacji wg pÅ‚ci",
    x = "Edukacja", y = "UdziaÅ‚ (%)", fill = "PÅ‚eÄ‡"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Funkcja do wykresÃ³w koÅ‚owych
make_pie <- function(data, country_label) {
  data %>%
    count(citizenship) %>%
    mutate(
      percent = n / sum(n) * 100,
      label = paste0(round(percent, 1), "%")
    ) %>%
    ggplot(aes(x = "", y = percent, fill = citizenship)) +
    geom_col(width = 1, color = "white") +
    coord_polar("y") +
    geom_text(aes(label = label),
              position = position_stack(vjust = 0.5), size = 4) +
    labs(
      title = paste("Obywatelstwo â€“", country_label),
      fill = "Obywatelstwo"
    ) +
    theme_void()
}




# Wykresy koÅ‚owe: obywatelstwo (Hiszpania vs ZEA)
pie_ES <- make_pie(ES_UAE_data %>% filter(country == "Spain"), "Hiszpania")
pie_UAE <- make_pie(ES_UAE_data %>% filter(country == "UAE"), "ZEA")

# Wykres 3: Zmiana struktury obywatelstwa w czasie
plot3 <- ggplot(ES_UAE_data, aes(x = year, fill = citizenship)) +
  geom_bar(position = "fill") +
  facet_wrap(~country) +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Zmiana struktury obywatelstwa w czasie",
    x = "Rok", y = "UdziaÅ‚ (%)", fill = "Obywatelstwo"
  ) +
  theme_minimal()



```

Column {data-width=500}
-----------------------------------------------------------------------

### SCATTER PLOT

``` {r}
plot1
plot2
```

Column {data-width=500}
-----------------------------------------------------------------------

### DOT PLOT

``` {r}
pie_ES
pie_UAE
```







