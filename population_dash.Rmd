---
title: "Population Data - Spain and United Arab Emiartes"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    source_code: embed
runtime: shiny
---

```{r setup, include=FALSE}

source("population_ES_UAE.R")
library(flexdashboard)
library(googlesheets4)
#gs4_auth()
# load data in 'global' chunk so it can be shared by all users of the dashboard
library(datasets)
data(faithful)
```



DATA SET {data-icon="fa-list"}
=====================================

**Population Data** Data Set.

Column {data-width=300}
-----------------------------------------------------------------------

### Data Set Basic Information

```{r results='asis', warning=FALSE}
source("Text/DataSetBasicInformation.R", encoding = "UTF-8")
cat(gsub("\n", "<br>", text))
```

### Aims 

```{r results='asis', warning=FALSE}
source("Text/Aims.R", encoding = "UTF-8")
cat(gsub("\n", "<br>", text_aims))
```




Column {data-width=300}
-----------------------------------------------------------------------
### Data Set


```{r}
library(DT)
library(tidyverse)
library(flexdashboard)
library(ggplot2)
source("population_final.R")


additional_data %>%
  DT::datatable(rownames = FALSE, options=list(pageLength=15))
```

BMI PLOTS {data-icon="fa-list"}
=====================================



Column {data-width=300}
-----------------------------------------------------------------------
### Data
```{r}
# Załaduj wymagane pakiety
library(tidyverse)
library(shiny)
# Wczytaj dane
additional_data <- read_csv("additional_data.csv")
# Dodaj kolumnę z kategorią BMI
additional_data <- additional_data %>%
  mutate(BMI_category = case_when(
    BMI < 18.5 ~ "Niedowaga",
    BMI >= 18.5 & BMI < 25 ~ "Prawidłowa",
    BMI >= 25 & BMI < 30 ~ "Nadwaga",
    BMI >= 30 ~ "Otyłość"
  ))
ui <- fluidPage(
  titlePanel("Średnie BMI w czasie dla wybranych krajów"),
  sidebarLayout(
    sidebarPanel(
      checkboxGroupInput(
        inputId = "selected_countries",
        label = "Wybierz kraj(e):",
        choices = unique(additional_data$country),
        selected = unique(additional_data$country)
      )
    ),
    mainPanel(
      plotOutput("bmi_plot")
    )
  )
)
server <- function(input, output) {
  output$bmi_plot <- renderPlot({
    # Filtrowanie danych na podstawie wybranych krajów
    filtered_data <- additional_data %>%
      filter(country %in% input$selected_countries) %>%
      group_by(country, year) %>%
      summarise(avg_BMI = mean(BMI, na.rm = TRUE)) %>%
      ungroup()
    # Tworzenie wykresu
    ggplot(filtered_data, aes(x = year, y = avg_BMI, color = country)) +
      # Obszary klasyfikacji BMI
      annotate("rect", xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = 18.5, fill = "lightblue", alpha = 0.1) +
      annotate("rect", xmin = -Inf, xmax = Inf, ymin = 18.5, ymax = 25, fill = "lightgreen", alpha = 0.1) +
      annotate("rect", xmin = -Inf, xmax = Inf, ymin = 25, ymax = 30, fill = "khaki", alpha = 0.1) +
      annotate("rect", xmin = -Inf, xmax = Inf, ymin = 30, ymax = Inf, fill = "lightcoral", alpha = 0.1) +
      # Linie średniego BMI dla każdego kraju
      geom_line(size = 1.2) +
       # Przerywane linie poziome dla progów BMI
 # Przerywane czarne linie poziome dla progów BMI
    geom_hline(yintercept = 18.5, linetype = "dashed", color = "black", size = 0.5) +
    geom_hline(yintercept = 25, linetype = "dashed", color = "black", size = 0.5) +
    geom_hline(yintercept = 30, linetype = "dashed", color = "black", size = 0.5) +
    # Podpisy dla linii progów BMI
    annotate("text", x = min(filtered_data$year, na.rm = TRUE), y = 18.5, label = "Niedowaga (18.5)", vjust = -0.5, hjust = 0, color = "black", size = 3) +
    annotate("text", x = min(filtered_data$year, na.rm = TRUE), y = 25, label = "Prawidłowa (25)", vjust = -0.5, hjust = 0, color = "black", size = 3) +
    annotate("text", x = min(filtered_data$year, na.rm = TRUE), y = 30, label = "Nadwaga (30)", vjust = -0.5, hjust = 0, color = "black", size = 3) +
      # Dodatkowe elementy wykresu
      labs(
        title = "Średnie BMI w czasie dla wybranych krajów",
        x = "Rok",
        y = "Średnie BMI",
        color = "Kraj"
      ) +
      theme_minimal()
  })
}
shinyApp(ui = ui, server = server)
```



UAE PLOT{data-icon="fa-list"} =====================================
###Data
Sidebar {.sidebar}
-----------------------------------------------------------------------
```{r}
selectInput("selected_plot", "Choose a plot:",
            choices = names(plots_list),
            selected = names(plots_list)[1])
```
Column {data-width=300}
-----------------------------------------------------------------------
```{r}
plotOutput("plot")
output$plot <- renderPlot({
  req(input$selected_plot)
  plots_list[[input$selected_plot]]()
})
```
------------------------------------------------------

